"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var fetchRestaurantsData=null,DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchRestaurants",value:function(){return fetchRestaurantsData||fetch(e.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return fetchRestaurantsData=Promise.resolve(e),e}).catch(function(e){console.log(e)})}},{key:"fetchRestaurantById",value:function(t){return e.fetchRestaurants().then(function(e){return e.find(function(e){return e.id==t})})}},{key:"fetchRestaurantByCuisine",value:function(t){return e.fetchRestaurants().then(function(e){return e.filter(function(e){return e.cuisine_type==t})})}},{key:"fetchRestaurantByNeighborhood",value:function(t){return e.fetchRestaurants().then(function(e){return e.filter(function(e){return e.neighborhood==t})})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n){return e.fetchRestaurants().then(function(e){var r=e;return"all"!=t&&(r=r.filter(function(e){return e.cuisine_type==t})),"all"!=n&&(r=r.filter(function(e){return e.neighborhood==n})),r})}},{key:"fetchNeighborhoods",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(t,n){return e[n].neighborhood});return t.filter(function(e,n){return t.indexOf(e)==n})})}},{key:"fetchCuisines",value:function(){return e.fetchRestaurants().then(function(e){var t=e.map(function(t,n){return e[n].cuisine_type});return t.filter(function(e,n){return t.indexOf(e)==n})})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"srcsetImageUrlForRestaurant",value:function(e){return e.srcset_restaurant}},{key:"srcsetImageUrlForIndex",value:function(e){return e.srcset_index}},{key:"mapMarkerForRestaurant",value:function(t,n){var r=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:"Localisation of "+t.name+" restaurant",url:e.urlForRestaurant(t)});return r.addTo(newMap),r}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),e}(),restaurant=void 0,newMap=void 0;document.addEventListener("DOMContentLoaded",function(e){initMap()});var initMap=function(){fetchRestaurantFromURL().then(function(e){e&&0!==e.length?(self.newMap=L.map("map",{center:[e.latlng.lat,e.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoibW9oY2luZTkyIiwiYSI6ImNqa21lY3JoZjF1cGozcXBrOGI5cnRlNGkifQ.VcGgA3YMmeEWpARnDTyxDQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap)):console.log("No restaurant found")}).catch(function(e){console.log(e)})},fetchRestaurantFromURL=function(){if(self.restaurant)return self.restaurant;var e=getParameterByName("id");return e?DBHelper.fetchRestaurantById(e).then(function(e){return self.restaurant=e,e&&fillRestaurantHTML(),e}):Promise.reject("No restaurant id in URL")},fillRestaurantHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.setAttribute("alt",e.name),t.className="restaurant-img",t.srcset=DBHelper.srcsetImageUrlForRestaurant(e),t.src=DBHelper.imageUrlForRestaurant(e),t.sizes="(max-width: 380px) 300px, (max-width: 480px) 400px, (max-width: 680px) 600px, (max-width: 768px) 800px, (max-width: 960px) 400px, (max-width: 1360px) 600px",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("div");n.className="review-header";var r=document.createElement("p");r.innerHTML=e.name,r.className="name",n.appendChild(r);var a=document.createElement("p");a.innerHTML=e.date,a.className="date",n.appendChild(a),t.appendChild(n);var i=document.createElement("span");i.innerHTML="Rating: "+e.rating,i.className="rating",t.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,o.className="comment",t.appendChild(o),t},fillBreadcrumb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},refreshing=!1;function serviceWorkerRegistration(){navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("controllerchange",function(){refreshing||(window.location.reload(),refreshing=!0)}),navigator.serviceWorker.register("sw/service-worker.js",{scope:"/"}).then(function(e){console.log("Service Worker Registered"),navigator.serviceWorker.controller&&(e.waiting?updateReady():e.installing?trackingprogressInstalled(e.installing):e.addEventListener("updatefound",function(){trackingprogressInstalled(e.installing)}))}).catch(function(e){return console.log("Service worker not registered: ",e)}))}function updateReady(e){confirm("New version available online. Do you want to update? ")&&e.postMessage({action:"skipWaiting"})}function trackingprogressInstalled(e){e.addEventListener("statechange",function(){"installed"==e.state&&updateReady(e)})}serviceWorkerRegistration();